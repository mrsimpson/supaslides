import{d as S,r as d,a as E,b as g,c as h,w as n,e,g as a,n as k,B as U,f as P,t as R,l as C,i as V,aN as $,m as T,o as W,h as F,aR as j,s as z}from"./index-CSmqUZEd.js";import{u as L}from"./use-message-BLUWky0e.js";import{_ as y,a as M}from"./FormItem-SDgVF96q.js";const G=S({__name:"SignInMagicLink",setup(x){const t=d(!1),{signInWithMagicLink:o}=E(),c=d(null),_=L(),r=d({email:""}),b={email:{required:!0,message:"Please enter your email",trigger:["input"]}},m=async s=>{var i;s.preventDefault(),await((i=c.value)==null?void 0:i.validate()),t.value=!0;const l=await o(r.value.email);l?_.error(l.message):_.success("Check your email for the login link!"),t.value=!1};return(s,l)=>(g(),h(a(C),{title:"Magic Link Signin",bordered:!1},{default:n(()=>[e(a(M),{inline:"",ref_key:"formRef",ref:c,model:r.value,rules:b,onSubmit:m},{default:n(()=>[e(a(y),{label:"E-mail",path:"email"},{default:n(()=>[e(a(k),{value:r.value.email,"onUpdate:value":l[0]||(l[0]=i=>r.value.email=i),placeholder:"your email"},null,8,["value"])]),_:1}),e(a(y),null,{default:n(()=>[e(a(U),{onClick:m,loading:t.value,disabled:t.value},{default:n(()=>[P(R(t.value?"Loading":"Send magic link"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),H=S({__name:"SignInUsernamePassword",setup(x){const t=d(!1),{signInWithPassword:o}=E(),c=d(null),_=L(),r=d({email:"",password:""}),b={email:{required:!0,message:"Please enter your email",trigger:["input"]},password:{required:!0,message:"Please enter your password",trigger:["input"]}},m=async s=>{var i;s.preventDefault(),await((i=c.value)==null?void 0:i.validate()),t.value=!0;const l=await o(r.value.email,r.value.password);l&&_.error(l.message),t.value=!1};return(s,l)=>(g(),h(a(C),{bordered:!1,title:"Signin for registered users"},{default:n(()=>[e(a(M),{ref_key:"formRef",ref:c,model:r.value,rules:b,inline:"",onSubmit:m},{default:n(()=>[e(a(y),{label:"E-mail",path:"email"},{default:n(()=>[e(a(k),{value:r.value.email,"onUpdate:value":l[0]||(l[0]=i=>r.value.email=i),"data-testid":"input-signin-email",placeholder:"your email"},null,8,["value"])]),_:1}),e(a(y),{label:"Password",path:"password"},{default:n(()=>[e(a(k),{value:r.value.password,"onUpdate:value":l[1]||(l[1]=i=>r.value.password=i),"data-testid":"input-signin-password",placeholder:"your password",type:"password"},null,8,["value"])]),_:1}),e(a(y),null,{default:n(()=>[e(a(U),{disabled:t.value,loading:t.value,"data-testid":"button-signin-submit",onClick:m},{default:n(()=>[P(R(t.value?"Loading":"Submit"),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),J=S({__name:"SignIn",setup(x){return(t,o)=>(g(),V($,null,[e(G),e(H)],64))}}),K=S({__name:"Account",setup(x){const t=d(!0),{session:o,fetchProfile:c,updateProfile:_,signOut:r}=E(),b=d(null),m=L(),s=d({username:"",website:"",avatar_url:""}),{t:l}=T(),i={username:{required:!0,message:l("please_enter_username_message"),trigger:["input"]},website:{required:!1},avatar_url:{required:!1}};W(()=>{B()});async function B(){if(!o||!o.user)return;const{user:f}=o;try{t.value=!0;const u=await c(f.id);u&&(s.value=u)}catch(u){u instanceof Error?alert(u.message):console.error("An unexpected error occurred:",u)}finally{t.value=!1}}async function A(f){var u;await((u=b.value)==null?void 0:u.validate());try{if(o&&o.user){t.value=!0;const{user:p}=o,v={id:p.id,username:s.value.username,website:s.value.website,avatar_url:s.value.avatar_url,updated_at:new Date().toISOString()};await _(v)&&m.success(l("profile_updated_message"))}}catch(p){p instanceof Error?m.error(p.message):console.error("An unexpected error occurred:",p)}finally{t.value=!1}}async function D(){try{t.value=!0,await r(),j.push("/")}catch(f){f instanceof Error?alert(f.message):console.error("An unexpected error occurred:",f)}finally{t.value=!1}}return(f,u)=>{const p=k,v=y,I=k,q=U,N=M,O=C;return g(),h(O,{bordered:!1,title:a(l)("account")},{default:n(()=>[e(N,{ref_key:"formRef",ref:b,model:s.value,rules:i,onSubmit:a(_)},{default:n(()=>[e(v,{label:a(l)("email_label")},{default:n(()=>{var w;return[e(p,{id:"email",value:(w=a(o))==null?void 0:w.user.email,"data-testid":"input-account-email",disabled:"",type:"text"},null,8,["value"])]}),_:1},8,["label"]),e(v,{label:a(l)("username_label"),path:"username"},{default:n(()=>[e(I,{id:"username",value:s.value.username,"onUpdate:value":u[0]||(u[0]=w=>s.value.username=w),"data-testid":"input-account-username",placeholder:"Enter your username",type:"text"},null,8,["value"])]),_:1},8,["label"]),e(v,{label:a(l)("website_label"),path:"website"},{default:n(()=>[e(I,{id:"website",value:s.value.website,"onUpdate:value":u[1]||(u[1]=w=>s.value.website=w),"data-testid":"input-account-website",placeholder:"Enter your website URL",type:"text"},null,8,["value"])]),_:1},8,["label"]),e(v,null,{default:n(()=>[e(q,{disabled:t.value,"data-testid":"button-account-updateProfile",onClick:F(A,["prevent"])},{default:n(()=>[P(R(a(l)("update_button")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model","onSubmit"]),e(v,null,{default:n(()=>[e(q,{"data-testid":"button-account-signOut",type:"error",onClick:D},{default:n(()=>[P(R(a(l)("sign_out_button")),1)]),_:1})]),_:1})]),_:1},8,["title"])}}}),Z=S({__name:"ProfileView",setup(x){const{session:t}=z(E());return(o,c)=>(g(),V("div",null,[a(t)?(g(),h(K,{key:1})):(g(),h(J,{key:0}))]))}});export{Z as default};
